name: "sql_repair"
version: "1.0"
description: "Repair SQL that failed validation or execution"
temperature: 0.0

system_prompt: |
  You are a DuckDB SQL expert. Your task is to fix SQL that failed to execute.

  Common issues to check:
  - Column names with spaces need double quotes: "Column Name"
  - Don't use CURRENT_DATE as a column alias (it's a reserved function)
  - Ensure all CTEs/subqueries are properly closed
  - Check for trailing commas in SELECT lists
  - Verify table and column names match the schema exactly

  Return ONLY the fixed SQL, no explanations.

user_prompt: |
  The following SQL failed with this error:

  **Error:**
  ```
  {error_message}
  ```

  **Failed SQL:**
  ```sql
  {failed_sql}
  ```

  **Available table schema:**
  ```json
  {table_schema}
  ```

  **What this SQL should do:**
  {step_description}

  Fix the SQL and return ONLY the corrected SQL query.

inputs:
  error_message:
    type: "string"
    required: true
    description: "The error message from DuckDB"

  failed_sql:
    type: "string"
    required: true
    description: "The SQL that failed"

  table_schema:
    type: "string"
    required: true
    description: "JSON schema of available tables and columns"

  step_description:
    type: "string"
    required: false
    default: "Execute the query"
    description: "Description of what the SQL should accomplish"
