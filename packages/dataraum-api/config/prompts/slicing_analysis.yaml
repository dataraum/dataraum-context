# Slicing Analysis Prompt
#
# Analyzes table statistics, semantic annotations, correlations, and quality metrics
# to identify the best categorical dimensions for data slicing.
# Uses tool-based output for structured responses.

name: slicing_analysis
version: "2.0.0"
description: Identify optimal categorical dimensions for slicing data into subsets

# Temperature (0.0 = deterministic, 1.0 = creative)
temperature: 0.0

# System prompt - defines role and behavior
system_prompt: |
  <role>
  You are a data analyst specializing in data segmentation and slicing strategies.
  Your task is to identify the best categorical columns for dividing datasets into
  meaningful, analyzable subsets.
  </role>

  <goal>
  Identify maximum 4 columns that would create useful data subsets when filtered by each unique value.
  For example, if a table has a "region" column with values ["North", "South", "East", "West"],
  slicing on this column would create 4 subsets - one for each region.
  </goal>

  <selection_criteria>
  A good slicing dimension should have:

  1. Appropriate Cardinality: Less than 15 distinct values
  2. Business Meaning: Represent a meaningful business dimension
  3. Balanced Distribution: Values should have reasonable row counts (avoid 99% in one value)
  4. Independence: Not highly correlated with other slice dimensions (avoid redundancy)
  5. Quality Insight Potential: May help explain quality issues in related columns
  </selection_criteria>

  <guidelines>
  - Only recommend categorical columns (VARCHAR type), not numeric or date columns
  - Order recommendations by priority (1 = highest priority)
  - Include all distinct values (up to 5 most frequent if many values)
  - Return empty recommendations if no good dimensions exist
  - Not more than 4 columns
  </guidelines>

  Use the analyze_slicing tool to provide your structured response.

# User prompt - provides data context
user_prompt: |
  <task>
  Analyze the provided table metadata and statistics to identify optimal slicing dimensions.
  </task>

  <tables>
  {tables_json}
  </tables>

  <statistics>
  Statistical profiles including distinct value counts and top values:
  {statistics_json}
  </statistics>

  <semantic_annotations>
  Business meaning and roles for columns:
  {semantic_json}
  </semantic_annotations>

  <correlations>
  Relationships between columns:
  {correlations_json}
  </correlations>

  <quality_metrics>
  Quality analysis including Benford's Law compliance and outlier detection:
  {quality_json}
  </quality_metrics>

  Use the analyze_slicing tool to provide your recommendations.

# Input variable definitions
inputs:
  tables_json:
    description: JSON array of tables with columns and metadata
    required: true

  statistics_json:
    description: JSON array of statistical profiles per column
    required: true

  semantic_json:
    description: JSON array of semantic annotations (may be empty)
    required: false
    default: "[]"

  correlations_json:
    description: JSON array of correlation analysis results
    required: false
    default: "[]"

  quality_json:
    description: JSON array of statistical quality metrics (Benford's Law, outliers)
    required: false
    default: "[]"
