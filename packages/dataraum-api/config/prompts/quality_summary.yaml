# Quality Summary Prompt
#
# Analyzes aggregated quality metrics across slices to generate
# human-readable quality summaries per column.
# Uses tool-based output for structured responses.

name: quality_summary
version: "2.0.0"
description: Generate quality summary for a column across data slices

# Temperature (0.0 = deterministic, 1.0 = creative)
temperature: 0.1

# System prompt - defines role and behavior
system_prompt: |
  <role>
  You are a data quality analyst specializing in cross-slice quality assessment.
  Your task is to analyze quality metrics across data slices and provide actionable insights.
  </role>

  <grading_scale>
  - A (0.9-1.0): Excellent - No significant issues, consistent across slices
  - B (0.8-0.89): Good - Minor issues, mostly consistent
  - C (0.6-0.79): Fair - Some issues need attention
  - D (0.4-0.59): Poor - Significant quality problems
  - F (0.0-0.39): Critical - Major data quality failures
  </grading_scale>

  <guidelines>
  - Focus on variations BETWEEN slices, not just within
  - Highlight slices that deviate significantly from the norm
  - For numeric columns, compare statistical distributions
  - For Benford violations, consider if they indicate data anomalies
  - For temporal issues, highlight incomplete periods, volume anomalies, and distribution drift
  - Make SQL queries DuckDB-compatible
  - Be specific about which slices have issues
  </guidelines>

  Use the summarize_quality tool to provide your structured response.

# User prompt - provides column data
user_prompt: |
  <task>
  Analyze the data quality for this column across all slices and provide a comprehensive assessment.
  </task>

  <column_context>
  Column: {column_name}
  Source Table: {source_table_name}
  Sliced By: {slice_column_name}
  Data Type: {resolved_type}
  Total Slices: {total_slices}
  Total Rows: {total_rows}
  </column_context>

  <semantic_info>
  Role: {semantic_role}
  Business Name: {business_name}
  Description: {business_description}
  </semantic_info>

  <quality_overview>
  Benford's Law violations: {benford_violations} slices
  Slices with outliers: {outlier_slices}
  Incomplete periods: {incomplete_periods}
  Volume anomalies: {volume_anomalies}
  Slices with distribution drift: {drift_detected_count}
  Temporal issues: {temporal_issues}
  </quality_overview>

  <slice_data>
  {slice_data_json}
  </slice_data>

  <temporal_data>
  {temporal_data_json}
  </temporal_data>

  Use the summarize_quality tool to provide your assessment including:
  - Overall quality score (0.0-1.0) and grade (A-F)
  - Brief summary
  - Key findings about patterns across slices
  - Quality issues with severity and affected slices
  - Slice comparisons showing metric variations
  - Recommendations for improvement
  - Investigation SQL queries for drilling into issues

# Input variable definitions
inputs:
  column_name:
    description: Name of the column being analyzed
    required: true

  source_table_name:
    description: Name of the source table
    required: true

  slice_column_name:
    description: Name of the column used for slicing
    required: true

  resolved_type:
    description: Data type of the column
    required: true

  total_slices:
    description: Number of slices analyzed
    required: true

  total_rows:
    description: Total rows across all slices
    required: true

  slice_data_json:
    description: JSON array of per-slice metrics
    required: true

  semantic_role:
    description: Semantic role of the column
    required: false
    default: "unknown"

  business_name:
    description: Business name for the column
    required: false
    default: ""

  business_description:
    description: Business description of the column
    required: false
    default: ""

  benford_violations:
    description: Number of slices with Benford violations
    required: false
    default: "0"

  outlier_slices:
    description: Number of slices with outliers
    required: false
    default: "0"

  incomplete_periods:
    description: Number of incomplete time periods across all slices
    required: false
    default: "0"

  volume_anomalies:
    description: Number of periods with volume anomalies across all slices
    required: false
    default: "0"

  drift_detected_count:
    description: Number of slices with significant distribution drift
    required: false
    default: "0"

  temporal_issues:
    description: List of temporal issues found
    required: false
    default: "None detected"

  temporal_data_json:
    description: JSON array of temporal analysis per slice
    required: false
    default: "[]"
