# Fiscal Period Integrity Validation
# Checks for complete and clean fiscal period cutoffs

validation_id: fiscal_period_integrity
name: Fiscal Period Integrity
description: >
  Validates fiscal period completeness and cutoff cleanliness.
  Checks for missing days within periods and transactions that fall
  outside expected period boundaries (early or late transactions).

category: financial
severity: warning
version: "1.0"

tags:
  - accounting
  - fiscal-period
  - cutoff
  - completeness

check_type: aggregate

parameters:
  # Default fiscal year end (December)
  fiscal_year_end_month: 12
  # Maximum acceptable gap in days
  max_gap_days: 5

sql_hints: >
  Look for date columns (transaction_date, posting_date, date, etc.).
  Check semantic annotations for entity_type: date, or semantic_role: temporal.

  Analyze the date range and distribution:
  1. Find min and max dates to determine the fiscal period
  2. Count distinct days with transactions
  3. Calculate expected vs actual coverage
  4. Identify any gaps > max_gap_days
  5. Count transactions outside fiscal year boundaries

  Return: period_start, period_end, expected_days, actual_days,
  missing_days, late_transactions (after period end),
  early_transactions (before period start), is_complete.

expected_outcome: >
  A complete fiscal period with:
  - missing_days <= max_gap_days
  - late_transactions = 0
  - early_transactions = 0
  - is_complete = true
