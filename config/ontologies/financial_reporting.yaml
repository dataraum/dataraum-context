# Financial Reporting Ontology
# 
# This ontology provides context for financial data analysis.
# It includes concepts, metrics, and quality rules specific to
# financial reporting and analysis.

name: financial_reporting
version: "1.0.0"
description: |
  Financial analysis and reporting context. Suitable for income statements,
  balance sheets, cash flow analysis, and general financial metrics.

# Concepts are semantic categories that columns can be mapped to
concepts:
  - name: revenue
    description: Income from sales or services
    indicators:
      - revenue
      - sales
      - income
      - turnover
      - receipts
    exclude_patterns:
      - cost
      - expense
    temporal_behavior: additive  # Can be summed over periods
    typical_role: measure
    
  - name: cost_of_goods_sold
    description: Direct costs attributable to goods sold
    indicators:
      - cogs
      - cost_of_goods
      - cost_of_sales
      - direct_cost
    temporal_behavior: additive
    typical_role: measure
    
  - name: operating_expense
    description: Expenses from normal business operations
    indicators:
      - opex
      - operating_expense
      - operating_cost
      - sga
      - overhead
    temporal_behavior: additive
    typical_role: measure
    
  - name: depreciation
    description: Allocation of asset cost over useful life
    indicators:
      - depreciation
      - depr
      - amortization
      - amort
    temporal_behavior: additive
    typical_role: measure
    
  - name: interest
    description: Interest income or expense
    indicators:
      - interest
      - interest_expense
      - interest_income
      - finance_cost
    temporal_behavior: additive
    typical_role: measure
    
  - name: tax
    description: Tax expense or benefit
    indicators:
      - tax
      - income_tax
      - tax_expense
      - tax_provision
    temporal_behavior: additive
    typical_role: measure
    
  - name: fiscal_period
    description: Time period for financial reporting
    indicators:
      - period
      - fiscal_period
      - reporting_period
      - quarter
      - fiscal_year
      - fy
      - month
      - date
    typical_role: timestamp

  - name: entity
    description: Business entity or cost center
    indicators:
      - entity
      - company
      - subsidiary
      - division
      - cost_center
      - department
      - business_unit
    typical_role: dimension
    
  - name: account
    description: Chart of accounts entry
    indicators:
      - account
      - gl_account
      - account_code
      - account_number
      - coa
    typical_role: dimension
    
  - name: currency
    description: Currency of monetary values
    indicators:
      - currency
      - ccy
      - curr
    typical_role: dimension
    typical_values:
      - USD
      - EUR
      - GBP
      - CHF
      - JPY

# Metrics define calculations that can be performed
metrics:
  - name: gross_profit
    formula: "revenue - cost_of_goods_sold"
    description: Revenue minus cost of goods sold
    required_concepts:
      - revenue
      - cost_of_goods_sold
    output_type: currency
    
  - name: gross_margin
    formula: "(revenue - cost_of_goods_sold) / revenue"
    description: Gross profit as percentage of revenue
    required_concepts:
      - revenue
      - cost_of_goods_sold
    output_type: percentage
    typical_range: [0.0, 0.8]
    
  - name: operating_income
    formula: "gross_profit - operating_expense"
    description: Earnings from core business operations
    required_concepts:
      - revenue
      - cost_of_goods_sold
      - operating_expense
    output_type: currency
    aliases:
      - EBIT (before D&A adjustments)
      
  - name: ebitda
    formula: "operating_income + depreciation"
    description: Earnings before interest, taxes, depreciation, and amortization
    required_concepts:
      - revenue
      - cost_of_goods_sold
      - operating_expense
      - depreciation
    output_type: currency
    
  - name: ebitda_margin
    formula: "ebitda / revenue"
    description: EBITDA as percentage of revenue
    required_concepts:
      - revenue
      - cost_of_goods_sold
      - operating_expense
      - depreciation
    output_type: percentage
    typical_range: [0.05, 0.4]
    
  - name: ebit
    formula: "revenue - cost_of_goods_sold - operating_expense"
    description: Earnings before interest and taxes
    required_concepts:
      - revenue
      - cost_of_goods_sold
      - operating_expense
    output_type: currency
    
  - name: net_income
    formula: "ebit - interest - tax"
    description: Bottom line profit after all expenses
    required_concepts:
      - revenue
      - cost_of_goods_sold
      - operating_expense
      - interest
      - tax
    output_type: currency
    
  - name: net_margin
    formula: "net_income / revenue"
    description: Net income as percentage of revenue
    required_concepts:
      - revenue
      - cost_of_goods_sold
      - operating_expense
      - interest
      - tax
    output_type: percentage
    typical_range: [-0.1, 0.3]

# Quality rules specific to financial data
quality_rules:
  - name: revenue_non_negative
    description: Revenue should not be negative
    applies_to: revenue
    rule_type: range
    expression: "value >= 0"
    severity: warning
    
  - name: margin_reasonable
    description: Gross margin should be between -50% and 100%
    applies_to: gross_margin
    rule_type: range
    expression: "value >= -0.5 AND value <= 1.0"
    severity: warning
    
  - name: period_no_gaps
    description: Financial periods should be continuous
    applies_to: fiscal_period
    rule_type: temporal_completeness
    severity: error
    
  - name: balance_sheet_balance
    description: Assets should equal liabilities plus equity
    rule_type: cross_column
    expression: "abs(assets - (liabilities + equity)) < 0.01"
    severity: error
    
  - name: cogs_less_than_revenue
    description: COGS should not exceed revenue (for healthy businesses)
    rule_type: cross_column
    expression: "cost_of_goods_sold <= revenue * 1.1"
    severity: warning

# Semantic hints for column name patterns
semantic_hints:
  - pattern: "*_amt"
    likely_type: currency
    likely_role: measure
    
  - pattern: "*_qty"
    likely_type: integer
    likely_role: measure
    
  - pattern: "*_pct"
    likely_type: percentage
    likely_role: measure
    
  - pattern: "*_dt"
    likely_type: date
    likely_role: timestamp
    
  - pattern: "*_id"
    likely_type: key
    likely_role: key
    
  - pattern: "*_code"
    likely_type: string
    likely_role: dimension
    
  - pattern: "fy*"
    likely_concept: fiscal_period
    likely_role: timestamp
    
  - pattern: "q[1-4]*"
    likely_concept: fiscal_period
    likely_role: timestamp

# Suggested queries for this ontology
suggested_queries:
  - description: Revenue trend by period
    sql: |
      SELECT {fiscal_period}, SUM({revenue}) as total_revenue
      FROM {table}
      GROUP BY 1
      ORDER BY 1
    complexity: simple
    
  - description: Margin analysis by period
    sql: |
      SELECT 
        {fiscal_period},
        SUM({revenue}) as revenue,
        SUM({cost_of_goods_sold}) as cogs,
        (SUM({revenue}) - SUM({cost_of_goods_sold})) / SUM({revenue}) as gross_margin
      FROM {table}
      GROUP BY 1
      ORDER BY 1
    complexity: medium
    
  - description: Period-over-period growth
    sql: |
      WITH periodic AS (
        SELECT {fiscal_period}, SUM({revenue}) as revenue
        FROM {table}
        GROUP BY 1
      )
      SELECT 
        {fiscal_period},
        revenue,
        LAG(revenue) OVER (ORDER BY {fiscal_period}) as prev_revenue,
        (revenue - LAG(revenue) OVER (ORDER BY {fiscal_period})) 
          / LAG(revenue) OVER (ORDER BY {fiscal_period}) as growth_rate
      FROM periodic
      ORDER BY 1
    complexity: complex
