# LLM Configuration
#
# Configure LLM providers for intelligent analysis features.
# When disabled, manual YAML configuration is required.

version: "1.0.0"

# Provider configurations
providers:
  anthropic:
    api_key_env: ANTHROPIC_API_KEY
    default_model: claude-sonnet-4-5
    models:
      fast: claude-haiku-4-5
      balanced: claude-sonnet-4-5

  openai:
    api_key_env: OPENAI_API_KEY
    default_model: gpt-4o
    models:
      fast: gpt-4o-mini
      balanced: gpt-4o

  local:
    # OpenAI-compatible local endpoint (e.g., Ollama, vLLM)
    base_url_env: LOCAL_LLM_BASE_URL
    api_key_env: LOCAL_LLM_API_KEY # Often "not-needed" for local
    default_model: llama3
    models:
      fast: llama3
      balanced: llama3

# Active provider (anthropic, openai, local)
active_provider: anthropic

# Feature toggles
features:
  semantic_analysis:
    enabled: true
    model_tier: balanced
    prompt_file: prompts/semantic_analysis.yaml
    description: >
      Analyze column roles, entity types, business terms,
      and relationships across tables.

  slicing_analysis:
    enabled: true
    model_tier: balanced
    prompt_file: prompts/slicing_analysis.yaml
    description: >
      Identify optimal categorical dimensions for slicing
      data into meaningful subsets for targeted analysis.

  quality_summary:
    enabled: true
    model_tier: fast
    prompt_file: prompts/quality_summary.yaml
    description: >
      Generate quality summaries per column aggregating findings
      across all slices for UI display.

  validation:
    enabled: true
    model_tier: balanced
    # Note: ValidationAgent uses inline prompts, not a yaml file
    description: >
      Generate SQL queries for validation checks using semantic
      annotations for column resolution. Supports financial and
      domain-specific validation rules.

  entropy_interpretation:
    enabled: true
    model_tier: balanced # Sonnet for quality reasoning on assumptions
    prompt_file: prompts/entropy_interpretation.yaml
    batch_size: 8 # Smaller batches for reliability
    description: >
      Interpret entropy metrics to generate contextual assumptions,
      resolution actions, and explanations. Replaces hardcoded
      heuristics with LLM-powered semantic interpretation.

  entropy_query_interpretation:
    enabled: true
    model_tier: balanced
    prompt_file: prompts/entropy_query_interpretation.yaml
    description: >
      Batch interpret entropy metrics for multiple columns in the
      context of a specific query. Returns interpretations considering
      how columns interact in the query.

  dimensional_summary:
    enabled: true
    model_tier: fast  # Haiku is sufficient - summarization of pre-computed data
    prompt_file: prompts/dimensional_summary.yaml
    description: >
      Generate LLM-powered executive summaries for dimensional entropy
      analysis results. Falls back to hardcoded summary when disabled.

  sql_repair:
    enabled: true
    model_tier: fast  # Haiku for quick repairs
    prompt_file: prompts/sql_repair.yaml
    max_repair_attempts: 2
    description: >
      Repair SQL that failed validation or execution by sending
      the error back to the LLM for correction.

# Fallback when LLM disabled or unavailable
fallback:
  semantic_analysis: manual_only # Require config/semantic_overrides.yaml

# Cost and rate controls
limits:
  max_input_tokens_per_request: 16000
  max_output_tokens_per_request: 8000
  max_columns_per_batch: 50
  max_requests_per_minute: 20
  cache_ttl_seconds: 86400 # 24 hours

# Privacy settings for data sent to LLM
privacy:
  # Sample values sent to LLM for analysis
  max_sample_values: 10

  # Use SDV to generate synthetic samples instead of real data
  # Requires: pip install sdv
  use_synthetic_samples: false
  synthetic_sample_count: 20

  # Columns matching these patterns are never sent to external LLM
  # (synthetic data generated instead if use_synthetic_samples=true)
  sensitive_patterns:
    - ".*email.*"
    - ".*phone.*"
    - ".*ssn.*"
    - ".*social_security.*"
    - ".*credit_card.*"
    - ".*password.*"
    - ".*secret.*"
    - ".*token.*"
    - ".*api_key.*"
