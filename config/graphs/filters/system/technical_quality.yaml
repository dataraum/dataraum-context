graph_id: "technical_quality"
graph_type: "filter"
version: "1.0"

metadata:
  name: "Technical Data Quality"
  description: "System-defined technical guardrails for data quality"
  category: "quality"
  source: "system"
  tags: ["technical", "quality", "guardrail"]

output:
  type: "classification"
  categories:
    clean: "Passes all technical checks"
    quarantine: "Technical quality issue"

dependencies:
  # Level 1: Atomic technical checks
  amount_not_null:
    level: 1
    type: "predicate"
    condition: "amount IS NOT NULL"
    on_false: "quarantine"
    reason: "Missing amount value"
    severity: "critical"

  amount_numeric:
    level: 1
    type: "predicate"
    condition: "TRY_CAST(amount AS DOUBLE) IS NOT NULL"
    on_false: "quarantine"
    reason: "Amount is not a valid number"
    severity: "critical"

  date_valid:
    level: 1
    type: "predicate"
    condition: "transaction_date IS NOT NULL AND transaction_date <= CURRENT_DATE"
    on_false: "quarantine"
    reason: "Invalid or future date"
    severity: "critical"

  account_reference:
    level: 1
    type: "predicate"
    condition: "account_id IS NOT NULL"
    on_false: "quarantine"
    reason: "Missing account reference"
    severity: "high"

  # Level 2: Composite classification
  technical_clean:
    level: 2
    type: "composite"
    logic: "amount_not_null AND amount_numeric AND date_valid AND account_reference"
    depends_on: ["amount_not_null", "amount_numeric", "date_valid", "account_reference"]
    output_step: true
