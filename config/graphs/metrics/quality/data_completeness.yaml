# Data Completeness Metric
#
# Computes a completeness score based on null ratios across columns.
# Can be computed globally or per-slice for dimensional analysis.

graph_id: "data_completeness"
graph_type: "metric"
version: "1.0"

# Scope: computed at both global and per-slice levels
scope: "both"
slice_dimension: null  # Set dynamically based on slicing agent recommendations

metadata:
  name: "Data Completeness Score"
  description: "Percentage of non-null values across all columns"
  category: "quality"
  source: "system"
  tags: ["quality", "completeness", "profiling"]

output:
  type: "scalar"
  metric_id: "data_completeness"
  unit: "percentage"
  decimal_places: 2

interpretation:
  ranges:
    - min_value: 95.0
      max_value: 100.0
      label: "excellent"
      description: "Data is highly complete with minimal missing values"
    - min_value: 85.0
      max_value: 95.0
      label: "good"
      description: "Data is mostly complete with acceptable missing values"
    - min_value: 70.0
      max_value: 85.0
      label: "fair"
      description: "Data has notable gaps that may affect analysis"
    - min_value: 0.0
      max_value: 70.0
      label: "poor"
      description: "Data has significant completeness issues requiring attention"

dependencies:
  # Extract null ratios from statistical profiles
  null_ratios:
    level: 1
    type: "extract"
    source:
      table: "statistical_profiles"
      column: "null_ratio"
      filter: "table_id IN (:table_ids)"
    aggregation: "avg"

  # Calculate completeness as inverse of null ratio
  completeness_score:
    level: 2
    type: "formula"
    expression: "(1 - null_ratios) * 100"
    depends_on: ["null_ratios"]
    output_step: true
