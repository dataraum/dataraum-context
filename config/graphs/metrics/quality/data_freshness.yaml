# Data Freshness Metric
#
# Measures how recent the data is based on temporal column analysis.
# Uses the staleness detection from temporal analysis module.

graph_id: "data_freshness"
graph_type: "metric"
version: "1.0"

# Scope: global only (freshness is dataset-level)
scope: "global"

metadata:
  name: "Data Freshness Score"
  description: "Measures how current the dataset is based on temporal columns"
  category: "quality"
  source: "system"
  tags: ["quality", "freshness", "temporal", "timeliness"]

parameters:
  - name: "expected_update_days"
    param_type: "integer"
    default: 7
    description: "Expected number of days between data updates"

output:
  type: "scalar"
  metric_id: "data_freshness"
  unit: "days"
  decimal_places: 1

interpretation:
  ranges:
    - min_value: 0.0
      max_value: 7.0
      label: "fresh"
      description: "Data is current and up-to-date"
    - min_value: 7.0
      max_value: 30.0
      label: "recent"
      description: "Data is reasonably current"
    - min_value: 30.0
      max_value: 90.0
      label: "aging"
      description: "Data is becoming stale"
    - min_value: 90.0
      max_value: 10000.0
      label: "stale"
      description: "Data is significantly outdated"

dependencies:
  # Extract max date from temporal columns
  most_recent_date:
    level: 1
    type: "extract"
    source:
      table: "temporal_column_profiles"
      column: "max_date"
      filter: "table_id IN (:table_ids)"
    aggregation: "max"

  # Calculate days since most recent data
  days_since_update:
    level: 2
    type: "formula"
    expression: "DATEDIFF('day', most_recent_date, CURRENT_DATE)"
    depends_on: ["most_recent_date"]
    output_step: true
