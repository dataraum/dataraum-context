graph_id: "dpo"
graph_type: "metric"
version: "1.0"

metadata:
  name: "Days Payable Outstanding"
  description: "Average days to pay suppliers after purchase"
  category: "working_capital"
  source: "system"
  tags: ["ap", "payment", "working-capital"]

output:
  type: "scalar"
  metric_id: "dpo"
  unit: "days"
  decimal_places: 1

requires_filters:
  - graph_id: "technical_quality"
    required: true
    required_classification: "clean"

parameters:
  days_in_period:
    type: "integer"
    default: 30
    options: [30, 90, 365]
    description: "Analysis period length"

dependencies:
  # Level 1: Extract base data
  accounts_payable:
    level: 1
    type: "extract"
    source:
      standard_field: "accounts_payable"
      statement: "balance_sheet"
    aggregation: "end_of_period"
    validation:
      - condition: "value >= 0"
        severity: "error"
        message: "AP cannot be negative"

  cost_of_goods_sold:
    level: 1
    type: "extract"
    source:
      standard_field: "cost_of_goods_sold"
      statement: "income_statement"
    aggregation: "sum"
    validation:
      - condition: "value > 0"
        severity: "error"
        message: "COGS must be positive for DPO"

  days_in_period:
    level: 1
    type: "constant"
    parameter: "days_in_period"
    default: 30

  # Level 2: Calculate DPO
  dpo:
    level: 2
    type: "formula"
    expression: "(accounts_payable / cost_of_goods_sold) * days_in_period"
    depends_on: ["accounts_payable", "cost_of_goods_sold", "days_in_period"]
    output_step: true
    validation:
      - condition: "value >= 0 AND value <= 365"
        severity: "warning"
        message: "DPO outside typical range"

interpretation:
  ranges:
    - min: 0
      max: 20
      label: "LOW"
      description: "Paying suppliers quickly - may miss cash optimization"
    - min: 21
      max: 45
      label: "GOOD"
      description: "Balanced payment terms"
    - min: 46
      max: 60
      label: "EXTENDED"
      description: "Maximizing payment terms"
    - min: 61
      max: 90
      label: "CONCERNING"
      description: "May strain supplier relationships"
    - min: 91
      max: 999
      label: "CRITICAL"
      description: "Risk of supply chain issues"
