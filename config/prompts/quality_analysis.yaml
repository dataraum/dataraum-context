# LLM Prompts for Quality Analysis
#
# These prompts power the LLM quality features in Phase 6:
# - Quality summaries (natural language descriptions)
# - Quality recommendations (prioritized action items)
# - Business cycle classification (topological analysis)

quality_summary:
  system: |
    You are a data quality expert analyzing quality metrics to provide clear,
    concise summaries for technical and non-technical stakeholders.

    Focus on:
    - Overall quality assessment (excellent, good, fair, poor)
    - Key strengths and weaknesses
    - Critical issues requiring immediate attention
    - Positive findings worth highlighting

    Keep your summary to 2-3 sentences maximum.

  user: |
    Analyze the following quality metrics and provide a brief summary:

    **Table**: {table_name}
    **Columns**: {column_count} columns, {columns_assessed} assessed

    **Quality Scores** (0.0 = poor, 1.0 = excellent):
    - Overall: {overall_score:.2f}
    - Completeness: {completeness_score:.2f}
    - Validity: {validity_score:.2f}
    - Consistency: {consistency_score:.2f}
    - Uniqueness: {uniqueness_score:.2f}
    - Timeliness: {timeliness_score:.2f}
    - Accuracy: {accuracy_score:.2f}

    **Issues**:
    - Total issues: {total_issues}
    - Critical: {critical_issues}
    - Warnings: {warnings}

    **Key Findings**:
    {key_findings}

    Provide a 2-3 sentence quality summary.

quality_recommendations:
  system: |
    You are a data quality expert providing actionable recommendations to improve
    data quality. Your recommendations should be:

    - Specific and actionable
    - Prioritized by impact (critical, high, medium, low)
    - Clear about what to do and why
    - Focused on root causes, not symptoms

    Format as a numbered list, ordered by priority (most critical first).

  user: |
    Based on the following quality assessment, provide prioritized recommendations
    to improve data quality:

    **Table**: {table_name}
    **Overall Quality Score**: {overall_score:.2f} / 1.0

    **Quality Issues by Dimension**:
    {issues_by_dimension}

    **Quality Issues by Pillar**:
    - Statistical: {statistical_issues} issues
    - Topological: {topological_issues} issues
    - Temporal: {temporal_issues} issues
    - Domain: {domain_issues} issues

    **Detailed Issues**:
    {detailed_issues}

    **Column-Level Problems**:
    {column_problems}

    Provide 3-5 prioritized recommendations. For each recommendation, specify:
    1. Priority level (CRITICAL/HIGH/MEDIUM/LOW)
    2. What to do
    3. Why it matters
    4. Expected impact on quality score

business_cycle_classification:
  system: |
    You are a business process expert analyzing topological cycles in data
    relationships. Your task is to classify detected cycles as either:

    - **Valid business cycle**: Legitimate circular relationship (e.g., orders ↔ shipments ↔ invoices)
    - **Data modeling issue**: Redundant relationship, should be normalized
    - **Referential integrity issue**: Orphaned records, broken relationships
    - **Unknown**: Need more context to classify

    For valid business cycles, explain the business logic.
    For issues, explain what's wrong and how to fix it.

  user: |
    Classify the following topological cycle detected in the data:

    **Table**: {table_name}
    **Cycle**: {cycle_description}

    **Cycle Details**:
    - Tables involved: {tables_in_cycle}
    - Relationship chain: {relationship_chain}
    - Persistence score: {persistence_score:.3f} (higher = more significant)

    **Context**:
    - Domain: {domain}
    - Table types: {table_types}
    - Relationship types: {relationship_types}

    **Additional Metrics**:
    - Betti number (cycles count): {betti_1}
    - Total relationships in table: {total_relationships}

    Classify this cycle and provide:
    1. Classification (VALID_BUSINESS_CYCLE / DATA_MODELING_ISSUE / REFERENTIAL_INTEGRITY_ISSUE / UNKNOWN)
    2. Confidence (HIGH/MEDIUM/LOW)
    3. Explanation (why this classification?)
    4. Recommendation (if it's an issue, how to fix?)

    Format as JSON:
    {{
      "classification": "...",
      "confidence": "...",
      "explanation": "...",
      "recommendation": "..." or null
    }}
