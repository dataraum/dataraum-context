# Quality Rule Generation Prompt
#
# Generates domain-specific quality rules based on semantic analysis.

name: quality_rules
version: "1.0.0"
description: Generate data quality rules based on semantic understanding

temperature: 0.0

prompt: |
  You are a data quality expert. Based on the semantic analysis of this schema, generate appropriate data quality rules.

  ## Schema with Semantic Annotations

  {schema_json}

  ## Ontology: {ontology_name}

  Domain-specific context:
  {ontology_rules}

  ## Instructions

  Generate quality rules that are:
  1. **Actionable**: Can be expressed as SQL predicates
  2. **Domain-appropriate**: Consider the business context
  3. **Non-redundant**: Don't duplicate obvious type constraints
  4. **Prioritized**: Focus on high-value validations

  ## Rule Types to Consider

  - **Completeness**: Required fields, conditional requirements
  - **Validity**: Value ranges, formats, enumerations
  - **Consistency**: Cross-column logic, temporal ordering
  - **Uniqueness**: Duplicate detection, key integrity
  - **Timeliness**: Data freshness, gap detection
  - **Referential**: Foreign key integrity

  ## Response Format

  Respond with valid JSON only:

  {
    "rules": [
      {
        "rule_name": "descriptive_name",
        "table_name": "...",
        "column_name": "..." or null for table-level,
        "rule_type": "completeness|validity|consistency|uniqueness|timeliness|referential",
        "severity": "error|warning|info",
        "expression": "SQL boolean expression",
        "description": "Human-readable description",
        "rationale": "Why this rule matters for this domain"
      }
    ]
  }

  ## Expression Syntax

  Use DuckDB SQL syntax. Reference columns as {column_name}.
  Examples:
  - `{amount} >= 0`
  - `{start_date} <= {end_date}`
  - `{status} IN ('active', 'inactive', 'pending')`
  - `{email} LIKE '%@%.%'`

inputs:
  schema_json:
    description: Schema with semantic annotations from analysis
    required: true
    
  ontology_name:
    description: Name of the ontology
    required: true
    
  ontology_rules:
    description: Domain-specific rules from ontology
    required: false

output_schema:
  type: object
  required:
    - rules
  properties:
    rules:
      type: array

validation:
  rule_types:
    - completeness
    - validity
    - consistency
    - uniqueness
    - timeliness
    - referential
  severity_values:
    - error
    - warning
    - info
